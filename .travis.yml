language: cpp

matrix:
  fast_finish: true
  include:
    # The lines from "# BEGIN GENERATED" through "# END GENERATED" are
    # generated by running |python mk/update-travis-yml.py|. Any changes
    # made to those lines will be overwritten while other lines will be left
    # untouched.
    #
    # BEGIN GENERATED

    - env: CLANG_VERSION=3.6 CMAKE_BUILD_TYPE=DEBUG ARCH=x86
      os: linux
      addons:
        apt:
          packages:
            - clang-3.6
            - g++-multilib
            - gcc-multilib
            - libc6-dev-i386
          sources:
            - llvm-toolchain-precise-3.6
            - ubuntu-toolchain-r-test

    - env: GCC_VERSION=4.8 CMAKE_BUILD_TYPE=DEBUG ARCH=x86
      os: linux
      addons:
        apt:
          packages:
            - g++-4.8
            - g++-4.8-multilib
            - gcc-4.8
            - gcc-4.8-multilib
            - linux-libc-dev:i386
          sources:
            - ubuntu-toolchain-r-test

    - env: CLANG_VERSION=3.5 CMAKE_BUILD_TYPE=DEBUG ARCH=x86
      os: linux
      addons:
        apt:
          packages:
            - clang-3.5
            - g++-multilib
            - gcc-multilib
            - libc6-dev-i386
          sources:
            - llvm-toolchain-precise-3.5
            - ubuntu-toolchain-r-test

    - env: CLANG_VERSION=3.4 CMAKE_BUILD_TYPE=DEBUG ARCH=x86
      os: linux
      addons:
        apt:
          packages:
            - g++-multilib
            - gcc-multilib
            - libc6-dev-i386
          sources:
            - ubuntu-toolchain-r-test

    - env: GCC_VERSION=5 CMAKE_BUILD_TYPE=DEBUG ARCH=x86
      os: linux
      addons:
        apt:
          packages:
            - g++-5
            - g++-5-multilib
            - gcc-5
            - gcc-5-multilib
            - linux-libc-dev:i386
          sources:
            - ubuntu-toolchain-r-test

    - env: CLANG_VERSION=3.6 CMAKE_BUILD_TYPE=RELWITHDEBINFO ARCH=x86
      os: linux
      addons:
        apt:
          packages:
            - clang-3.6
            - g++-multilib
            - gcc-multilib
            - libc6-dev-i386
          sources:
            - llvm-toolchain-precise-3.6
            - ubuntu-toolchain-r-test

    - env: GCC_VERSION=4.8 CMAKE_BUILD_TYPE=RELWITHDEBINFO ARCH=x86
      os: linux
      addons:
        apt:
          packages:
            - g++-4.8
            - g++-4.8-multilib
            - gcc-4.8
            - gcc-4.8-multilib
            - linux-libc-dev:i386
          sources:
            - ubuntu-toolchain-r-test

    - env: CLANG_VERSION=3.5 CMAKE_BUILD_TYPE=RELWITHDEBINFO ARCH=x86
      os: linux
      addons:
        apt:
          packages:
            - clang-3.5
            - g++-multilib
            - gcc-multilib
            - libc6-dev-i386
          sources:
            - llvm-toolchain-precise-3.5
            - ubuntu-toolchain-r-test

    - env: CLANG_VERSION=3.4 CMAKE_BUILD_TYPE=RELWITHDEBINFO ARCH=x86
      os: linux
      addons:
        apt:
          packages:
            - g++-multilib
            - gcc-multilib
            - libc6-dev-i386
          sources:
            - ubuntu-toolchain-r-test

    - env: GCC_VERSION=5 CMAKE_BUILD_TYPE=RELWITHDEBINFO ARCH=x86
      os: linux
      addons:
        apt:
          packages:
            - g++-5
            - g++-5-multilib
            - gcc-5
            - gcc-5-multilib
            - linux-libc-dev:i386
          sources:
            - ubuntu-toolchain-r-test

    - env: CLANG_VERSION=3.6 CMAKE_BUILD_TYPE=DEBUG ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            - clang-3.6
          sources:
            - llvm-toolchain-precise-3.6
            - ubuntu-toolchain-r-test

    - env: GCC_VERSION=4.8 CMAKE_BUILD_TYPE=DEBUG ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            - g++-4.8
            - gcc-4.8
          sources:
            - ubuntu-toolchain-r-test

    - env: CLANG_VERSION=3.5 CMAKE_BUILD_TYPE=DEBUG ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            - clang-3.5
          sources:
            - llvm-toolchain-precise-3.5
            - ubuntu-toolchain-r-test

    - env: CLANG_VERSION=3.4 CMAKE_BUILD_TYPE=DEBUG ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            

    - env: GCC_VERSION=5 CMAKE_BUILD_TYPE=DEBUG ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            - g++-5
            - gcc-5
          sources:
            - ubuntu-toolchain-r-test

    - env: GCC_VERSION=4.9 CMAKE_BUILD_TYPE=DEBUG ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            - g++-4.9
            - gcc-4.9
          sources:
            - ubuntu-toolchain-r-test

    - env: CLANG_VERSION=3.6 CMAKE_BUILD_TYPE=RELWITHDEBINFO ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            - clang-3.6
          sources:
            - llvm-toolchain-precise-3.6
            - ubuntu-toolchain-r-test

    - env: GCC_VERSION=4.8 CMAKE_BUILD_TYPE=RELWITHDEBINFO ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            - g++-4.8
            - gcc-4.8
          sources:
            - ubuntu-toolchain-r-test

    - env: CLANG_VERSION=3.5 CMAKE_BUILD_TYPE=RELWITHDEBINFO ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            - clang-3.5
          sources:
            - llvm-toolchain-precise-3.5
            - ubuntu-toolchain-r-test

    - env: CLANG_VERSION=3.4 CMAKE_BUILD_TYPE=RELWITHDEBINFO ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            

    - env: GCC_VERSION=5 CMAKE_BUILD_TYPE=RELWITHDEBINFO ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            - g++-5
            - gcc-5
          sources:
            - ubuntu-toolchain-r-test

    - env: GCC_VERSION=4.9 CMAKE_BUILD_TYPE=RELWITHDEBINFO ARCH=x86_64
      os: linux
      addons:
        apt:
          packages:
            - g++-4.9
            - gcc-4.9
          sources:
            - ubuntu-toolchain-r-test

    # END GENERATED

install:
  - |
    if [[ "$GCC_VERSION" != "" ]]
    then export CC="gcc-$GCC_VERSION" CXX="g++-$GCC_VERSION"
    fi

  - |
    if [[ "$CLANG_VERSION" != "" ]]
    then export CC="clang-$CLANG_VERSION" CXX="clang++-$CLANG_VERSION"
    fi

  # clang 3.4 is the default version of clang in Travis CI.
  - if [[ "$CLANG_VERSION" == "3.4" ]]; then export CC=clang CXX=clang++; fi

  - |
    git clone -b OpenSSL_1_0_2-stable --depth 1 --single-branch \
                 https://github.com/openssl/openssl build/openssl

  - |
    git clone -b master --depth 1 --single-branch \
              https://github.com/briansmith/googletest build/gtest

before_script:
  # The version specifications leave some ambiguity over the precise version of
  # the compiler, so clarify which exactly which versions are being used.
  - $CC --version
  - $CXX --version
  - make --version

script:
  - make openssl-configure
  - make openssl
  - make -j2
  - make check
  # Verify nothing was added to source directory during build.
  - '! git clean --dry-run | grep ".*"'
  - make -j2 clean
  # XXX: Because we put GTest and OpenSSL into build/, we don't have a great
  # way of testing that |make clean| deleted everything that was generated.
